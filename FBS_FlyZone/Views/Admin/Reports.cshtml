@{
    ViewData["Title"] = "Raporlar";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-4">Raporlar</h2>
            <p class="text-muted">FlyZone uçuş rezervasyon sistemi istatistiklerini ve raporlarını bu sayfadan inceleyebilirsiniz.</p>
        </div>
    </div>
    
    <!-- Rapor Filtresi -->
    <div class="card mb-4">
        <div class="card-body">
            <form class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Başlangıç Tarihi</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Bitiş Tarihi</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Rapor Türü</label>
                    <select class="form-select" id="reportType">
                        <option value="reservations" selected>Rezervasyonlar</option>
                        <option value="revenue">Gelirler</option>
                        <option value="users">Kullanıcılar</option>
                        <option value="flights">Uçuşlar</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="button" class="btn btn-primary w-100" id="filterReport">
                        <i class="bi bi-funnel me-1"></i> Filtrele
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="row">
        <!-- Aylık Rezervasyon Grafiği -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Aylık Rezervasyon İstatistikleri</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">PNG olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyReservationsChart" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Havayolları Rezervasyon Dağılımı -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Havayollarına Göre Rezervasyonlar</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">PNG olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="airlineReservationsChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- En Popüler Rotalar -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">En Popüler Rotalar</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Kalkış</th>
                                    <th>Varış</th>
                                    <th>Rezervasyon Sayısı</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>İstanbul</td>
                                    <td>Antalya</td>
                                    <td>243</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>İstanbul</td>
                                    <td>İzmir</td>
                                    <td>187</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Ankara</td>
                                    <td>İstanbul</td>
                                    <td>165</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>İzmir</td>
                                    <td>İstanbul</td>
                                    <td>158</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>Antalya</td>
                                    <td>İstanbul</td>
                                    <td>136</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Aylık Gelir Raporu -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Aylık Gelir Raporu (TL)</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyRevenueChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Önemli Metrikler -->
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Önemli Performans Göstergeleri (KPI)</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Doluluk Oranı</h6>
                                    <h2>82.7%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 82.7%" aria-valuenow="82.7" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-up"></i> 4.3% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">İptal Oranı</h6>
                                    <h2>3.2%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 3.2%" aria-valuenow="3.2" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-down"></i> 0.8% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Business Class Oranı</h6>
                                    <h2>14.5%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 14.5%" aria-valuenow="14.5" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-up"></i> 2.1% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Ortalama Bilet Fiyatı</h6>
                                    <h2>1,245 TL</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-danger d-block mt-2"><i class="bi bi-arrow-down"></i> 120 TL geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Aylık Rezervasyon Grafiği
            var monthlyCtx = document.getElementById('monthlyReservationsChart').getContext('2d');
            var monthlyChart = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'],
                    datasets: [{
                        label: 'Rezervasyon Sayısı',
                        data: [65, 59, 80, 81, 56, 55, 40, 45, 60, 49, 52, 50],
                        borderColor: '#0d6efd',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                borderDash: [2, 4]
                            },
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Havayolları Rezervasyon Dağılımı
            var airlineCtx = document.getElementById('airlineReservationsChart').getContext('2d');
            var airlineChart = new Chart(airlineCtx, {
                type: 'pie',
                data: {
                    // göysermelik bir rapor paneli yaptım, düzeltilir.
                    labels: ['Türk Hava Yolları', 'Pegasus', 'SunExpress', 'AnadoluJet', 'Diğer'],
                    datasets: [{
                        data: [45, 25, 15, 10, 5],
                        backgroundColor: [
                            '#0d6efd',
                            '#6f42c1',
                            '#dc3545',
                            '#fd7e14',
                            '#0dcaf0'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Aylık Gelir Raporu
            var revenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
            var revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'],
                    datasets: [{
                        label: 'Gelir (TL)',
                        data: [1250000, 980000, 1450000, 1320000, 1600000, 1780000],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderColor: 'rgb(40, 167, 69)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('tr-TR', {
                                        style: 'currency',
                                        currency: 'TRY',
                                        maximumFractionDigits: 0
                                    }).format(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Filtreleme işlevi
            $('#filterReport').click(function() {
                var startDate = $('#startDate').val();
                var endDate = $('#endDate').val();
                var reportType = $('#reportType').val();
                
                // Gerçek uygulamada Ajax ile sunucudan veriler alınır
                // Demo amaçlı rastgele veriler oluşturuldu
                
                if (reportType === 'reservations') {
                    // Rezervasyon grafiğini güncelle
                    monthlyChart.data.datasets[0].data = Array.from({length: 12}, () => Math.floor(Math.random() * 100) + 20);
                    monthlyChart.update();
                } else if (reportType === 'revenue') {
                    // Gelir grafiğini güncelle
                    revenueChart.data.datasets[0].data = Array.from({length: 6}, () => Math.floor(Math.random() * 1000000) + 500000);
                    revenueChart.update();
                }
                
                // Filtre başarılı bildirimi
                alert('Rapor filtrelendi: ' + startDate + ' - ' + endDate + ' (' + reportType + ')');
            });
        });
    </script>
}