@{
    ViewData["Title"] = "Raporlar";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-4">Raporlar</h2>
            <p class="text-muted">FlyZone uçuş rezervasyon sistemi istatistiklerini ve raporlarını bu sayfadan inceleyebilirsiniz.</p>
        </div>
    </div>

    <!-- Rapor Filtresi -->
    <div class="card mb-4">
        <div class="card-body">
            <form class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Başlangıç Tarihi</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Bitiş Tarihi</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Rapor Türü</label>
                    <select class="form-select" id="reportType">
                        <option value="reservations" selected>Rezervasyonlar</option>
                        <option value="revenue">Gelirler</option>
                        <option value="users">Kullanıcılar</option>
                        <option value="flights">Uçuşlar</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="button" class="btn btn-primary w-100" id="filterReport">
                        <i class="bi bi-funnel me-1"></i> Filtrele
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <!-- Aylık Rezervasyon Grafiği -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Aylık Rezervasyon İstatistikleri</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">PNG olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyReservationsChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Havayolları Rezervasyon Dağılımı -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Havayollarına Göre Rezervasyonlar</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">PNG olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="airlineReservationsChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- En Popüler Rotalar -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">En Popüler Rotalar</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Kalkış</th>
                                    <th>Varış</th>
                                    <th>Rezervasyon Sayısı</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.TopRoutes != null && ViewBag.TopRoutes is IEnumerable<dynamic>)
                                {
                                    var routeList = ((IEnumerable<dynamic>)ViewBag.TopRoutes).ToList();
                                    for (int i = 0; i < routeList.Count; i++)
                                    {
                                        var route = routeList[i];
                                        <tr>
                                            <td>@(i + 1)</td>
                                            <td>@route.Route.From</td>
                                            <td>@route.Route.To</td>
                                            <td>@route.Count</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="4" class="text-center">Veri bulunamadı</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aylık Gelir Raporu -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Aylık Gelir Raporu (TL)</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="monthlyRevenueChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Önemli Metrikler -->
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Önemli Performans Göstergeleri (KPI)</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Doluluk Oranı</h6>
                                    <h2>82.7%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 82.7%" aria-valuenow="82.7" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-up"></i> 4.3% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">İptal Oranı</h6>
                                    <h2>3.2%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 3.2%" aria-valuenow="3.2" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-down"></i> 0.8% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Business Class Oranı</h6>
                                    <h2>14.5%</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 14.5%" aria-valuenow="14.5" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-success d-block mt-2"><i class="bi bi-arrow-up"></i> 2.1% geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="text-muted">Ortalama Bilet Fiyatı</h6>
                                    <h2>1,245 TL</h2>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-danger d-block mt-2"><i class="bi bi-arrow-down"></i> 120 TL geçen aya göre</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Rota Karşılaştırma Analizi -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Rota Karşılaştırma Analizi</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="input-group">
                                <select class="form-select" id="route1Selector">
                                    <option selected>Rota 1 seçin...</option>
                                    <option value="ist-ank">İstanbul - Ankara</option>
                                    <option value="ist-izm">İstanbul - İzmir</option>
                                    <option value="ist-ant">İstanbul - Antalya</option>
                                    <option value="ank-izm">Ankara - İzmir</option>
                                    <option value="ank-ant">Ankara - Antalya</option>
                                </select>
                                <span class="input-group-text">vs</span>
                                <select class="form-select" id="route2Selector">
                                    <option selected>Rota 2 seçin...</option>
                                    <option value="ist-ank">İstanbul - Ankara</option>
                                    <option value="ist-izm">İstanbul - İzmir</option>
                                    <option value="ist-ant">İstanbul - Antalya</option>
                                    <option value="ank-izm">Ankara - İzmir</option>
                                    <option value="ank-ant">Ankara - Antalya</option>
                                </select>
                                <button class="btn btn-primary" id="compareRoutesBtn">Karşılaştır</button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="comparisonMetric">
                                <option value="all" selected>Tüm metrikler</option>
                                <option value="revenue">Gelir</option>
                                <option value="occupancy">Doluluk Oranı</option>
                                <option value="satisfaction">Müşteri Memnuniyeti</option>
                                <option value="cancellation">İptal Oranı</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="routeComparisonChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gerçek Zamanlı Uçuş İzleme Paneli -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        Gerçek Zamanlı Uçuş İzleme
                        <span class="badge bg-danger blink ms-2">CANLI</span>
                    </h5>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary" id="refreshRealTimeData">
                            <i class="bi bi-arrow-clockwise"></i> Yenile
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-download"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                                <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="flight-map-container" style="height: 400px; background-color: #eaeaea; position: relative; border-radius: 5px;">
                                <div class="d-flex justify-content-center align-items-center h-100">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary mb-3" role="status"></div>
                                        <p class="mb-0">Uçuş Haritası Yükleniyor...</p>
                                        <small class="text-muted">Gerçek uygulamada burada interaktif bir harita yer alacak</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h6 class="border-bottom pb-2 mb-3">Anlık Uçuş Durumları</h6>
                            <div class="table-responsive" style="max-height: 350px; overflow-y: auto;">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Uçuş</th>
                                            <th>Güzergah</th>
                                            <th>Durum</th>
                                        </tr>
                                    </thead>
                                    <tbody id="realTimeFlightList">
                                        <tr>
                                            <td>TK1923</td>
                                            <td>İST-ANK</td>
                                            <td><span class="badge bg-success">Zamanında</span></td>
                                        </tr>
                                        <tr>
                                            <td>TK2145</td>
                                            <td>İST-İZM</td>
                                            <td><span class="badge bg-warning">30 dk Rötarlı</span></td>
                                        </tr>
                                        <tr>
                                            <td>PC1453</td>
                                            <td>SAW-AYT</td>
                                            <td><span class="badge bg-info">Havada</span></td>
                                        </tr>
                                        <tr>
                                            <td>TK1326</td>
                                            <td>ANK-İZM</td>
                                            <td><span class="badge bg-success">Zamanında</span></td>
                                        </tr>
                                        <tr>
                                            <td>XQ1515</td>
                                            <td>ADB-ESB</td>
                                            <td><span class="badge bg-danger">İptal</span></td>
                                        </tr>
                                        <tr>
                                            <td>PC2071</td>
                                            <td>SAW-AYT</td>
                                            <td><span class="badge bg-success">Zamanında</span></td>
                                        </tr>
                                        <tr>
                                            <td>TK2590</td>
                                            <td>İST-ANK</td>
                                            <td><span class="badge bg-success">Zamanında</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    <span class="badge bg-success me-1">15</span> Zamanında
                                    <span class="badge bg-warning mx-1">3</span> Rötarlı
                                    <span class="badge bg-danger ms-1">1</span> İptal
                                </div>
                                <a href="#" class="btn btn-sm btn-outline-primary">Tüm Uçuşlar</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ödeme Yöntemi ve Finansal Analiz -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Ödeme Yöntemi Analizi</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Tarih Aralığı</label>
                                <select class="form-select form-select-sm" id="paymentPeriodFilter">
                                    <option value="last30days" selected>Son 30 Gün</option>
                                    <option value="last3months">Son 3 Ay</option>
                                    <option value="last6months">Son 6 Ay</option>
                                    <option value="lastyear">Son 1 Yıl</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="alert alert-info py-1 mt-4">
                                <small><i class="bi bi-info-circle-fill"></i> <strong>Son 30 günde</strong> toplam <strong>3,482</strong> ödeme işlemi gerçekleşti.</small>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <canvas id="paymentMethodChart" height="300"></canvas>
                        </div>
                        <div class="col-md-5">
                            <div class="table-responsive mt-3">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Ödeme Yöntemi</th>
                                            <th>İşlem</th>
                                            <th>Oran</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><i class="bi bi-credit-card text-primary"></i> Kredi Kartı</td>
                                            <td>2,156</td>
                                            <td>62%</td>
                                        </tr>
                                        <tr>
                                            <td><i class="bi bi-bank text-success"></i> Banka Transferi</td>
                                            <td>685</td>
                                            <td>19.7%</td>
                                        </tr>
                                        <tr>
                                            <td><i class="bi bi-paypal text-info"></i> Mobil Ödeme</td>
                                            <td>423</td>
                                            <td>12.1%</td>
                                        </tr>
                                        <tr>
                                            <td><i class="bi bi-wallet2 text-warning"></i> Dijital Cüzdan</td>
                                            <td>183</td>
                                            <td>5.2%</td>
                                        </tr>
                                        <tr>
                                            <td><i class="bi bi-currency-exchange text-secondary"></i> Diğer</td>
                                            <td>35</td>
                                            <td>1%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Finansal Performans Göstergeleri</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                            <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <h6 class="text-muted mb-2">Ortalama Rezervasyon Değeri</h6>
                                    <h2 class="mb-0 text-success">₺1,450</h2>
                                    <small class="text-success"><i class="bi bi-arrow-up"></i> %5.3 artış</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <h6 class="text-muted mb-2">Aylık Gelir</h6>
                                    <h2 class="mb-0 text-success">₺5.3M</h2>
                                    <small class="text-success"><i class="bi bi-arrow-up"></i> %12.7 artış</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <h6 class="text-muted mb-2">İşlem Başarı Oranı</h6>
                                    <h2 class="mb-0 text-success">98.7%</h2>
                                    <small class="text-success"><i class="bi bi-arrow-up"></i> %0.8 artış</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <h6 class="text-muted mb-2">İade Oranı</h6>
                                    <h2 class="mb-0 text-danger">2.3%</h2>
                                    <small class="text-success"><i class="bi bi-arrow-down"></i> %0.5 azalış</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- En Çok Rezervasyon Yapılan Ay Kartı -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">En Çok Rezervasyon Yapılan Ay</h5>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-download"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Excel'e aktar</a></li>
                        <li><a class="dropdown-item" href="#">PDF olarak kaydet</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                @if (ViewBag.MostBookedMonth != null)
                {
                    <div class="text-center">
                        <h1 class="display-4 text-primary">@ViewBag.MostBookedMonthName</h1>
                        <p class="lead">Toplam <strong>@ViewBag.MostBookedMonthCount</strong> rezervasyon</p>
                       
                    </div>
                }
                else
                {
                    <div class="alert alert-info">
                        Henüz rezervasyon verisi bulunmamaktadır.
                    </div>
                }
            </div>
        </div>
    </div>


</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Controller'dan gelen verileri JavaScript değişkenlerine aktarma
            var monthlyReservationsData = @Html.Raw(Json.Serialize(ViewBag.MonthlyReservations));

            // Havayolları istatistikleri için veri hazırlama
            var airlineLabels = [];
            var airlineData = [];

        @if (ViewBag.AirlineStats != null)
        {
            <text>
                    var airlineStats = @Html.Raw(Json.Serialize(ViewBag.AirlineStats));
                    for (var airline in airlineStats) {
                        if (airlineStats.hasOwnProperty(airline)) {
                            airlineLabels.push(airline);
                            airlineData.push(airlineStats[airline]);
                        }
                    }
            </text>
        }

            // Rastgele renkler oluşturma fonksiyonu
            function generateColors(count) {
                var colors = [];
                var baseColors = ['#0d6efd', '#6f42c1', '#dc3545', '#fd7e14', '#0dcaf0', '#198754', '#ffc107'];

                for (var i = 0; i < count; i++) {
                    colors.push(baseColors[i % baseColors.length]);
                }

                return colors;
            }

            // Aylık Rezervasyon Grafiği
            var monthlyCtx = document.getElementById('monthlyReservationsChart').getContext('2d');
            var monthlyChart = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'],
                    datasets: [{
                        label: 'Rezervasyon Sayısı',
                        data: monthlyReservationsData,
                        borderColor: '#0d6efd',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                borderDash: [2, 4]
                            },
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });

            // Havayolları Rezervasyon Dağılımı
            var airlineCtx = document.getElementById('airlineReservationsChart').getContext('2d');
            var airlineChart = new Chart(airlineCtx, {
                type: 'pie',
                data: {
                    labels: airlineLabels,
                    datasets: [{
                        data: airlineData,
                        backgroundColor: generateColors(airlineLabels.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Aylık Gelir Raporu (örnek veri - controller'dan gelmiyor)
            var revenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
            var revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'],
                    datasets: [{
                        label: 'Gelir (TL)',
                        data: [1250000, 980000, 1450000, 1320000, 1600000, 1780000],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderColor: 'rgb(40, 167, 69)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('tr-TR', {
                                        style: 'currency',
                                        currency: 'TRY',
                                        maximumFractionDigits: 0
                                    }).format(value);
                                }
                            }
                        }
                    }
                }
            });

            // Filtreleme işlevi
            $('#filterReport').click(function() {
                var startDate = $('#startDate').val();
                var endDate = $('#endDate').val();
                var reportType = $('#reportType').val();

                // Gerçek uygulamada Ajax ile sunucudan veriler alınır
                // Demo amaçlı rastgele veriler oluşturuldu

                if (reportType === 'reservations') {
                    // Rezervasyon grafiğini güncelle
                    monthlyChart.data.datasets[0].data = Array.from({length: 12}, () => Math.floor(Math.random() * 100) + 20);
                    monthlyChart.update();
                } else if (reportType === 'revenue') {
                    // Gelir grafiğini güncelle
                    revenueChart.data.datasets[0].data = Array.from({length: 6}, () => Math.floor(Math.random() * 1000000) + 500000);
                    revenueChart.update();
                }

                // Filtre başarılı bildirimi
                alert('Rapor filtrelendi: ' + startDate + ' - ' + endDate + ' (' + reportType + ')');
            });

            // Aylık rezervasyon dağılımı grafiği
            var reservationsByMonth = @Html.Raw(Json.Serialize(ViewBag.ReservationsByMonth));
            var monthNames = @Html.Raw(Json.Serialize(ViewBag.MonthNames));

            // Ay numaralarını ay isimlerine dönüştürme
            var labels = [];
            var data = [];
            var monthNameMap = {};

            // Ay numarası -> ay ismi eşleştirmesini oluştur
            monthNames.forEach(function(item) {
                monthNameMap[item.MonthNumber] = item.MonthName;
            });

            // Verileri grafik için hazırla
            reservationsByMonth.forEach(function(item) {
                labels.push(monthNameMap[item.Month]);
                data.push(item.Count);
            });

            // Müşteri Memnuniyeti Grafiği
            var customerSatisfactionCtx = document.getElementById('customerSatisfactionChart');
            var customerSatisfactionChart;
            if (customerSatisfactionCtx) {
                customerSatisfactionChart = new Chart(customerSatisfactionCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Çok Kötü', 'Kötü', 'Orta', 'İyi', 'Çok İyi'],
                        datasets: [{
                            label: 'Müşteri Değerlendirmeleri',
                            data: [25, 78, 142, 450, 550],
                            backgroundColor: [
                                'rgba(220, 53, 69, 0.7)',   // Çok Kötü - Kırmızı
                                'rgba(255, 193, 7, 0.7)',   // Kötü - Sarı
                                'rgba(108, 117, 125, 0.7)', // Orta - Gri
                                'rgba(13, 202, 240, 0.7)',  // İyi - Mavi
                                'rgba(25, 135, 84, 0.7)'    // Çok İyi - Yeşil
                            ],
                            borderColor: [
                                'rgb(220, 53, 69)',
                                'rgb(255, 193, 7)',
                                'rgb(108, 117, 125)',
                                'rgb(13, 202, 240)',
                                'rgb(25, 135, 84)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        let percentage = Math.round((context.raw / total) * 100);
                                        return context.raw + ' değerlendirme (' + percentage + '%)';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }

            // Grafik oluştur
            var monthlyDistCtx = document.getElementById('monthlyDistributionChart');
            var monthlyDistChart;
            if (monthlyDistCtx) {
                monthlyDistChart = new Chart(monthlyDistCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Rezervasyon Sayısı',
                            data: data,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgb(54, 162, 235)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y + ' rezervasyon';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }

            // Rota Karşılaştırma Analizi - Örnek veri tanımları
            var routeData = {
                'ist-ank': {
                    name: 'İstanbul - Ankara',
                    revenue: 1200000,
                    occupancy: 85,
                    satisfaction: 4.5,
                    cancellation: 3
                },
                'ist-izm': {
                    name: 'İstanbul - İzmir',
                    revenue: 950000,
                    occupancy: 78,
                    satisfaction: 4.2,
                    cancellation: 4
                },
                'ist-ant': {
                    name: 'İstanbul - Antalya',
                    revenue: 1100000,
                    occupancy: 82,
                    satisfaction: 4.3,
                    cancellation: 2
                },
                'ank-izm': {
                    name: 'Ankara - İzmir',
                    revenue: 870000,
                    occupancy: 75,
                    satisfaction: 4.1,
                    cancellation: 5
                },
                'ank-ant': {
                    name: 'Ankara - Antalya',
                    revenue: 920000,
                    occupancy: 80,
                    satisfaction: 4.4,
                    cancellation: 3
                }
            };

            // Rota Karşılaştırma Analizi Grafiği
            var routeComparisonCtx = document.getElementById('routeComparisonChart').getContext('2d');
            var routeComparisonChart = new Chart(routeComparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['Rota karşılaştırması için rota seçiniz...'],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var label = context.dataset.label || '';
                                    var value = context.parsed.y || 0;
                                    
                                    if (label.includes('Gelir')) {
                                        return label + ': ' + new Intl.NumberFormat('tr-TR', {
                                            style: 'currency',
                                            currency: 'TRY',
                                            maximumFractionDigits: 0
                                        }).format(value);
                                    } else if (label.includes('Doluluk') || label.includes('İptal')) {
                                        return label + ': %' + value;
                                    } else {
                                        return label + ': ' + value;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                callback: function(value, index, values) {
                                    // Y ekseni etiketlerini özelleştir
                                    return value;
                                }
                            }
                        }
                    }
                }
            });

            // Rota karşılaştırma işlevi
            $('#compareRoutesBtn').click(function() {
                var route1 = $('#route1Selector').val();
                var route2 = $('#route2Selector').val();
                var metric = $('#comparisonMetric').val();
                
                // İki rota seçildiğinden emin ol
                if (route1 === 'Rota 1 seçin...' || route2 === 'Rota 2 seçin...') {
                    alert('Lütfen karşılaştırmak için iki rota seçiniz.');
                    return;
                }
                
                // Aynı rota seçildiğinde uyar
                if (route1 === route2) {
                    alert('Lütfen karşılaştırma için farklı rotalar seçiniz.');
                    return;
                }
                
                // İlgili rota verilerini al
                var route1Data = routeData[route1];
                var route2Data = routeData[route2];
                
                if (!route1Data || !route2Data) {
                    alert('Seçilen rotalar için veri bulunamadı.');
                    return;
                }
                
                // Grafik verilerini hazırla
                var labels = [route1Data.name, route2Data.name];
                var datasets = [];
                
                if (metric === 'all' || metric === 'revenue') {
                    datasets.push({
                        label: 'Gelir (TL)',
                        data: [route1Data.revenue, route2Data.revenue],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderColor: 'rgb(40, 167, 69)',
                        borderWidth: 1
                    });
                }
                
                if (metric === 'all' || metric === 'occupancy') {
                    datasets.push({
                        label: 'Doluluk Oranı (%)',
                        data: [route1Data.occupancy, route2Data.occupancy],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1
                    });
                }
                
                if (metric === 'all' || metric === 'satisfaction') {
                    datasets.push({
                        label: 'Müşteri Memnuniyeti (5 üzerinden)',
                        data: [route1Data.satisfaction, route2Data.satisfaction],
                        backgroundColor: 'rgba(255, 193, 7, 0.7)',
                        borderColor: 'rgb(255, 193, 7)',
                        borderWidth: 1
                    });
                }
                
                if (metric === 'all' || metric === 'cancellation') {
                    datasets.push({
                        label: 'İptal Oranı (%)',
                        data: [route1Data.cancellation, route2Data.cancellation],
                        backgroundColor: 'rgba(220, 53, 69, 0.7)',
                        borderColor: 'rgb(220, 53, 69)',
                        borderWidth: 1
                    });
                }
                
                // Grafiği güncelle
                routeComparisonChart.data.labels = labels;
                routeComparisonChart.data.datasets = datasets;
                routeComparisonChart.update();
                
                // Karşılaştırma özeti
                var comparisonMessage = route1Data.name + ' ve ' + route2Data.name + ' rotaları başarıyla karşılaştırıldı.';
                
                // Grafik altına karşılaştırma özeti ekle
                var summaryHtml = '<div class="alert alert-info mt-3">' +
                    '<h6 class="alert-heading">Karşılaştırma Sonucu:</h6>' +
                    '<p class="mb-0">İki rota arasındaki farklar grafik üzerinde gösterilmiştir. ';
                
                // Gelir karşılaştırması
                if (metric === 'all' || metric === 'revenue') {
                    var revenueDiff = Math.abs(route1Data.revenue - route2Data.revenue);
                    var revenuePerc = ((revenueDiff / Math.min(route1Data.revenue, route2Data.revenue)) * 100).toFixed(1);
                    var betterRevenue = route1Data.revenue > route2Data.revenue ? route1Data.name : route2Data.name;
                    
                    summaryHtml += '<br><strong>Gelir:</strong> ' + betterRevenue + ' rotası %' + revenuePerc + ' daha yüksek gelir sağlıyor.';
                }
                
                // Doluluk oranı karşılaştırması
                if (metric === 'all' || metric === 'occupancy') {
                    var occDiff = Math.abs(route1Data.occupancy - route2Data.occupancy);
                    var betterOcc = route1Data.occupancy > route2Data.occupancy ? route1Data.name : route2Data.name;
                    
                    summaryHtml += '<br><strong>Doluluk:</strong> ' + betterOcc + ' rotası %' + occDiff + ' daha yüksek doluluk oranına sahip.';
                }
                
                // Memnuniyet karşılaştırması
                if (metric === 'all' || metric === 'satisfaction') {
                    var satDiff = Math.abs(route1Data.satisfaction - route2Data.satisfaction).toFixed(1);
                    var betterSat = route1Data.satisfaction > route2Data.satisfaction ? route1Data.name : route2Data.name;
                    
                    summaryHtml += '<br><strong>Memnuniyet:</strong> ' + betterSat + ' rotası ' + satDiff + ' puan daha yüksek müşteri memnuniyetine sahip.';
                }
                
                // İptal oranı karşılaştırması
                if (metric === 'all' || metric === 'cancellation') {
                    var canDiff = Math.abs(route1Data.cancellation - route2Data.cancellation);
                    var betterCan = route1Data.cancellation < route2Data.cancellation ? route1Data.name : route2Data.name;
                    
                    summaryHtml += '<br><strong>İptal Oranı:</strong> ' + betterCan + ' rotasında %' + canDiff + ' daha az iptal görülüyor.';
                }
                
                summaryHtml += '</p></div>';
                
                // Mevcut özet varsa kaldır
                $('.route-comparison-summary').remove();
                
                // Yeni özeti ekle
                $(summaryHtml)
                    .addClass('route-comparison-summary')
                    .insertAfter($('.chart-container'));
            });

            // Ödeme Yöntemi Analizi
            var paymentMethodCtx = document.getElementById('paymentMethodChart').getContext('2d');
            var paymentMethodChart = new Chart(paymentMethodCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Kredi Kartı', 'Banka Transferi', 'Mobil Ödeme', 'Dijital Cüzdan', 'Diğer'],
                    datasets: [{
                        data: [62, 19.7, 12.1, 5.2, 1],
                        backgroundColor: ['#0d6efd', '#198754', '#0dcaf0', '#ffc107', '#6c757d'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + '%';
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
}
